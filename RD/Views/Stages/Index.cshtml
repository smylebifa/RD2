@model RD.Models.Stage;

@{
        ViewBag.Title = ViewBag.ThemeName;
        Layout = "_Layout";

        List<string> stageLevel1 = new List<string> { "Разработка ТЗ НИР", "Выбор направления исследования", "Теоретические и экспериментальные исследования","Обобщение и оценка результатов исследований", "Приемка научно-исследовательской работы" };

        var stageLevel2 = new string[][] {

        new string[] {},

        new string[] {
            "Сбор и изучение научно-технической литературы, нормативно-технической документации,  эксплуатационной информации об аналоговых и других материалах, относящихся к разрабатываемой теме." ,
            "Проведение патентных исследований. Составление отчета по патентным исследованиям в соответствии с ГОСТ 15.011",
            "Формулирование возможных направлений решения задач, поставленных в ТЗ НИР, и их сравнительная оценка",
            "Выбор и обоснование принятого направления исследований и способов решения поставленных задач",
            "Метрологическая проработка и заполнение соответствующего акта",
            "Сопоставление ожидаемых показателей новой продукции после внедрения результатов НИР с существующими показателями изделий-аналогов или с действующей нормативно-технической документацией.",
            "Расчет ориентировочной экономической эффективности от внедрения новой продукции с ожидаемыми показателями НИР на основе научного прогнозирования на время разработки, освоения и срока морального старения выпускаемой продукции.",
            "Разработка общей методики проведения исследований",
            "Составление промежуточного отчета и его рассмотрение." },

           new string[] {
            "Разработка рабочих гипотез, построение моделей объекта исследований, обоснование допущений." ,
            "Выявление необходимости проведения экспериментов для подтверждения отдельных положений теоретических исследований для получения конкретных значений параметров (коэффициентов, необходимых для проведения расчетов)." ,
            "Разработка методики экспериментальных исследований, подготовка моделей (макетов экспериментальных образцов), а также испытательных стендов (установок).",
            "Определение номенклатур технической документации на макеты (модели, экспериментальные образцы) в соответствии с ГОСТ 2.102-68 и ее разработка.",
            "Проведение экспериментов, обработка данных.",
            "Сопоставление результатов эксперимента с теоретическими исследованиями.",
            "Корректировка теоретических моделей объекта, корректировка технической документации по результатам эксперимента.",
            "Проведение дополнительных экспериментов. ",
            "Проведение технико-экономических исследований эффективности внедрения исследования в народное хозяйство.",
            "Составление промежуточного отчета и его рассмотрение." },

           new string[] {
            "Обобщение результатов предыдущих этапов работ. Оценка полноты решения задач." ,
            "Проведение дополнительных исследований, в том числе патентных." ,
            "Метрологическая проработка. Составление акта метрологической проработки.",
            "Разработка рекомендаций по использованию результатов проведенных НИР.",
            "Формулирование технических требований для технического задания на разработку продукции",
            "Составление и оформление отчета по ГОСТ 7.32-2001 Нормоконтроль отчета по ГОСТ 2.111-68  ",
            "Рассмотрение результатов проведенных НИР и приѐмка работы в целом. " }

          
    };

     List <string> ExpandFREDS = new List<string> {"expandFRED1", "expandFRED2", "expandFRED3" };

     List <string> ExpandSUBS = new List<string> {"expandSUB1", "expandSUB2", "expandSUB3" };



    //    var stageLevel2_2 = new string[][] {
    //    new string[] {
    //        "Сбор и изучение научно-технической литературы, нормативно-технической документации,  эксплуатационной информации об аналоговых и других материалах, относящихся к разрабатываемой теме." ,
    //        "Проведение патентных исследований. Составление отчета по патентным исследованиям в соответствии с ГОСТ 15.011",
    //        "Формулирование возможных направлений решения задач, поставленных в ТЗ НИР, и их сравнительная оценка",
    //        "Выбор и обоснование принятого направления исследований и способов решения поставленных задач",
    //        "Метрологическая проработка и заполнение соответствующего акта",
    //        "Сопоставление ожидаемых показателей новой продукции после внедрения результатов НИР с существующими показателями изделий-аналогов или с действующей нормативно-технической документацией.",
    //        "Расчет ориентировочной экономической эффективности от внедрения новой продукции с ожидаемыми показателями НИР на основе научного прогнозирования на время разработки, освоения и срока морального старения выпускаемой продукции.",
    //        "Разработка общей методики проведения исследований",
    //        "Составление промежуточного отчета и его рассмотрение." }

    //};

    //var stageLevel2_3 = new string[][] {

    //    new string[] { 
    //        "Разработка рабочих гипотез, построение моделей объекта исследований, обоснование допущений." , 
    //        "Выявление необходимости проведения экспериментов для подтверждения отдельных положений теоретических исследований для получения конкретных значений параметров (коэффициентов, необходимых для проведения расчетов)." ,
    //        "Разработка методики экспериментальных исследований, подготовка моделей (макетов экспериментальных образцов), а также испытательных стендов (установок).",
    //        "Определение номенклатур технической документации на макеты (модели, экспериментальные образцы) в соответствии с ГОСТ 2.102-68 и ее разработка.",
    //        "Проведение экспериментов, обработка данных.",
    //        "Сопоставление результатов эксперимента с теоретическими исследованиями.",
    //        "Корректировка теоретических моделей объекта, корректировка технической документации по результатам эксперимента.",
    //        "Проведение дополнительных экспериментов. ",
    //        "Проведение технико-экономических исследований эффективности внедрения исследования в народное хозяйство.",
    //        "Составление промежуточного отчѐта и его рассмотрение." }
    //};

    //var stageLevel2_4 = new string[][] {

    //    new string[] { 
    //        "Обобщение результатов предыдущих этапов работ. Оценка полноты решения задач." , 
    //        "Проведение дополнительных исследований, в том числе патентных." ,
    //        "Метрологическая проработка. Составление акта метрологической проработки.",
    //        "Разработка рекомендаций по использованию результатов проведенных НИР.",
    //        "Формулирование технических требований для технического задания на разработку продукции",
    //        "Составление и оформление отчѐта по ГОСТ 7.32-2001 Нормоконтроль отчета по ГОСТ 2.111-68  ",
    //        "Рассмотрение результатов проведенных НИР и приѐмка работы в целом. " }
    //};
}

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm">
                <h3 style="color: #343a40;">Тема - @ViewBag.ThemeName</h3>
            </div>
        </div>

        <div class="row">
            <div class="col-sm">
                @* <h4> <a class="nav-link text-primary" asp-controller="Stage" asp-action="Stage">Добавить этап</a> </h4>*@
                <h5> <a class="nav-link" asp-route-themeName="@ViewBag.ThemeName" asp-controller="Stages" asp-action="Stage">Добавить этап</a> </h5>
            </div>


            <div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-route-themeName="@ViewBag.ThemeName" asp-controller="AnnualFinancings" asp-action="Index">Финансирование</a> </h5>
            </div>

            @*<div class="col-sm">
            <h5> <a class="nav-link" href="#">Договоры</a> </h5>
        </div>*@

            <div class="col-sm">
                <h5> <a class="nav-link" asp-controller="Files" asp-action="Index">Файлы</a> </h5>
            </div>

            <div class="col-sm">
                <h5> <a class="nav-link" asp-controller="Contracts" asp-action="Index">Договоры</a></h5>
            </div>

            <div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-controller="RIAs" asp-action="Index">РИД</a> </h5>
            </div>

            <div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-controller="Products" asp-action="Index">Продукты</a> </h5>
            </div>

            <div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-controller="ScientificDocs" asp-action="Index">Научно-техническая документация</a> </h5>
            </div>

            <div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-route-themeName="@ViewBag.ThemeName" asp-controller="TRLs" asp-action="Index">TRL</a> </h5>
            </div>
            

        </div>
    </div>

        <script>
            $(document).ready(function () {
                $('[data-toggle="toggle"]').change(function () {
                    $(this).parents().next('.hide').toggle();
                });
            });

            $(document).ready(function () {
                $(".expandFRED1").click(function () {
                    $(".expandSUB1").toggle();
                });
                $(".expandFRED2").click(function () {
                    $(".expandSUB2").toggle();
                });
                 $(".expandFRED3").click(function () {
                    $(".expandSUB3").toggle();
                });
                $(".expandVALS").click(function () {
                    $(".expandCAT1").toggle();
                });
            })
        </script>

        <style>
            .label tr td label {
                display: block;
            }

            [data-toggle='toggle'] {
                display: none;
            }

            .expandSUB1 {
                display: none;
            }

            .expandSUB2 {
                display: none;
            }

            .expandSUB3 {
                display: none;
            }

            . {
                display: none;
            }

                .expandCAT1 {
                    display: none;
                }

                .expandFRED1, .expandFRED2, .expandFRED3 {
            cursor: pointer;
        }
        </style>


        <div style="overflow-x:auto;">
            <table class="table table-hover table-bordered" style="text-align: center; ">

                <thead>
                    <tr>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;"></th>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">№ этапа</th>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Этап</th>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Срок выполнения - начало</th>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Срок выполнения - конец</th>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Сумма этапа</th>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Акт о завершении</th>
                        <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Статус</th>
                    </tr>
                </thead>


                @{int i = 0; int j = 0; int iView = 0; int jView = 0;}
                @foreach (var stage in @ViewBag.Stages)
                {
                    if (i == 0)
                    {
                        <tbody>
                            <tr>
                                <td></td>
                                <td>@stage.NumStage</td>
                                <td>@stageLevel1[i]</td>
                                <td>@stage.WorkStart</td>
                                <td>@stage.WorkEnd</td>
                                <td>@stage.Amount</td>
                                <td>@stage.CompletionAct</td>
                                <td>@stage.Status</td>


                            </tr>
                        </tbody>
                                                
                    }

                    else
                    {
                        <tbody style="background-color: #ececec;">
                            <tr>
                                <td></td>
                                <td>@stage.NumStage</td>
                                <td class='@ExpandFREDS[i - 1]'>@stageLevel1[i] ▼</td>
                                <td>@stage.WorkStart</td>
                                <td>@stage.WorkEnd</td>
                                <td>@stage.Amount</td>
                                <td>@stage.CompletionAct</td>
                                <td>@stage.Status</td>


                            </tr>
                        </tbody>

                        j = 0;
                       
                        iView = i + 1;

                        @foreach (var stage2 in stageLevel2[i])
                        {
                            jView = j + 1;

                            <tbody class="hide">
                                <tr>
                                    <td class='@ExpandSUBS[i - 1] expandVALS'></td>
                                    <td class='@ExpandSUBS[i - 1]'>@iView.@jView </td>
                                    <td class='@ExpandSUBS[i - 1]' align='right'>
                                        @stage2
                                    </td>
                                    <td class='@ExpandSUBS[i - 1]'></td>
                                    <td class='@ExpandSUBS[i - 1]' align='right'></td>
                                    <td class='@ExpandSUBS[i - 1]' align='right'></td>
                                    <td class='@ExpandSUBS[i - 1]' align='right'></td>
                                    <td class='@ExpandSUBS[i - 1]' align='right'></td>
                                </tr>

                            </tbody>

                            j++;

                        }

                       
                    }

                     i++;

                }




            </table>
        </div>
