@model RD.Models.Stage;

@{
    ViewBag.Title = ViewBag.ThemeName;
    Layout = "_Layout";

    var CurTheme = ViewBag.CurrentTheme;

    var el = 0;

    if (CurTheme.DocType == "Гос.Контракт")

        el = 0;
    else if (CurTheme.DocType == "Договор")
        el = 1;
    else if (CurTheme.DocType == "Контракт")
        el = 2;
    else if (CurTheme.DocType == "Хоз.договора")
        el = 3;

    string WorkStart = "";
    string WorkEnd = "";

}

@{
    @if (ViewBag.CurrentTheme.WorkStart != null)
    {
        WorkStart = @ViewBag.CurrentTheme.WorkStart.ToString("yyyy-MM-dd");
    }
    else
    {
        WorkStart = @ViewBag.CurrentTheme.WorkStart;
    }

    @if (ViewBag.CurrentTheme.WorkEnd != null)
    {
        WorkEnd = @ViewBag.CurrentTheme.WorkEnd.ToString("yyyy-MM-dd");
    }
    else
    {
        WorkEnd = @ViewBag.CurrentTheme.WorkEnd;
    }
}


<div class="container-fluid">
    <div class="row" style="align-items:center">
        <div class="col-sm-5">

            <div class="row">
                <div class="col-sm-5">
                    <h3 style="color: #343a40;">Тема - @ViewBag.ThemeName </h3>
                </div>

                <div class="col-sm-7"></div>
            </div>

            <form method="post" asp-action="Edit" asp-controller="Themes" class="my-2 col-10" style="border-style: dashed; border-width:thin; border-color: #343a40; padding: 8px; ">

                <table>

                    <input name="Id" type="number" hidden value="@ViewBag.CurrentTheme.Id" />


                    <tr>
                        <td style="padding: 4px;">№ темы:</td>
                        <td style="padding: 4px;">
                            <input type="number" name="Number" value="@ViewBag.CurrentTheme.Number" />
                        </td>
                    </tr>


                    <tr>
                        <td style="padding: 4px;">Наименование темы:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="Name" value="@ViewBag.CurrentTheme.Name" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">ФИО руководителя:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="FioManager" value="@ViewBag.CurrentTheme.FioManager" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Подразделение исполнитель:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="ExecutiveDepartment" value="@ViewBag.CurrentTheme.ExecutiveDepartment" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Заказчик работы:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="CustomerName" value="@ViewBag.CurrentTheme.CustomerName" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Срок - начало:</td>
                        <td style="padding: 4px;">
                            <input type="date" id="WorkStart" name="WorkStart" value="@WorkStart" min="1950-01-01" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Срок - конец:</td>
                        <td style="padding: 4px;">
                            <input type="date" id="WorkEnd" name="WorkEnd" min="1950-01-01" value="@WorkEnd" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Приказ об открытии темы:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="Decree" value="@ViewBag.CurrentTheme.Decree" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Вид документа:</td>
                        <td style="padding: 4px;">
                            <select name="DocType" size="1">
                                <option value="Гос. Контракт">Гос. Контракт</option>
                                <option value="Договор">Договор</option>
                                <option value="Контракт">Контракт</option>
                                <option value="Хоз. договора">Хоз. договора</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Общий объем финансирования:</td>
                        <td style="padding: 4px;">
                            <input type="number" name="Amount" value="@ViewBag.CurrentTheme.Amount" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">НДС:</td>
                        <td style="padding: 4px;">
                            <input type="number" name="Vat" value="@ViewBag.CurrentTheme.Vat" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Объем без НДС:</td>
                        <td style="padding: 4px;">
                            <input type="number" name="AmountWithoutVat" value="@ViewBag.CurrentTheme.AmountWithoutVat" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Реквизиты документа:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="Props" value="@ViewBag.CurrentTheme.Props" />
                        </td>
                    </tr>




                    @*@Html.DropDownListFor(model => model.TeamId, ViewBag.Teams as SelectList)*@


                    @*<td style="padding: 4px;">
                    <select name="DocType" size="1">
                        <option @{if (el= =0) { @("selected") } } value="Гос. Контракт">Гос. Контракт</option>
                        <option @{if (el= =1) "selected" } value="Договор">Договор</option>
                        <option @{if (el= =2) "selected" } value="Контракт">Контракт</option>
                        <option @{if (el= =3) "selected" } value="Хоз. договора">Хоз. договора</option>
                    </select>
                </td>*@


                    <tr>
                        <td style="padding: 4px;">Тип исследования:</td>
                        <td style="padding: 4px;">
                            <select name="ResearchType" size="1">
                                <option value="Прикладное">Прикладное</option>
                                <option value="Фундаментальное">Фундаментальное</option>
                                <option value="Разработка">Разработка</option>
                                <option value="Поисковое">Поисковое</option>
                                <option value="ОКР">ОКР</option>
                            </select>
                        </td>
                    </tr>


                    <tr>
                        <td style="padding: 4px;">Область знания:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="Knowledge" value="@ViewBag.CurrentTheme.Knowledge" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Статус:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="Status" value="@ViewBag.CurrentTheme.Status" />
                        </td>
                    </tr>


                    @*@(ViewBag.Trls.Trl1_1 && ViewBag.Trls.Trl1_2 && ViewBag.Trls.Trl1_3 && ViewBag.Trls.Trl1_4 && ViewBag.Trls.Trl1_5 ? "checked=\"checked\"" : "")

                <td style="padding: 4px;">
                        @Html.TextBoxFor(m => m.ResearchType)
                    </td>*@

                

                    <tr style="margin-top: 10px;">
                        <td style="padding: 4px;">
                        </td>

                        <td style="padding: 4px;">
                            <input type="submit" class="btn btn-outline-primary changeThemeBtn" value="Сохранить изменения" />
                        </td>

                        <td style="padding: 4px;">
                        </td>
                    </tr>


                </table>
            </form>
        </div>

        <div class="col-sm-7" style="border-style: dashed; border-width:thin; border-color: #343a40; padding: 8px; ">

            <div class="row">
                <div class="col-sm-2">
                    <h3 style="color: #343a40;">Этапы</h3>
                </div>

                <div class="col-sm-1">
                    <h3> <a class="nav-link text-primary" asp-controller="Stages" asp-action="Stage" style="float:left">+</a> </h3>
                </div>

                <div class="col-sm-9"></div>
            </div>

            <div class="row" style="align-items:center">

                @*<div class="col-sm">*@
                @*<h5> <a class="nav-link" asp-route-themeName="@ViewBag.ThemeName" asp-controller="Stages" asp-action="Stage">Добавить этап</a> </h5>
            </div>*@



                <div class="col-sm">
                    <h5> <a class="nav-link" asp-area="" asp-route-themeName="@ViewBag.ThemeName" asp-controller="AnnualFinancings" asp-action="Index">Финансирование</a> </h5>
                </div>

                @*<div class="col-sm">
                <h5> <a class="nav-link" href="#">Договоры</a> </h5>
            </div>*@

                <div class="col-sm">
                    <h5> <a class="nav-link" asp-controller="Files" asp-action="Index">Файлы</a> </h5>
                </div>

                <div class="col-sm">
                    <h5> <a class="nav-link" asp-controller="Contracts" asp-action="Index">Договоры</a></h5>
                </div>

                @*<div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-controller="RIAs" asp-action="Index">РИД</a> </h5>
            </div>

            <div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-controller="Products" asp-action="Index">Продукты</a> </h5>
            </div>

            <div class="col-sm">
                <h5> <a class="nav-link" asp-area="" asp-controller="ScientificDocs" asp-action="Index">Научно-техническая документация</a> </h5>
            </div>*@

                <div class="col-sm">
                    <h5> <a class="nav-link" asp-area="" asp-route-themeName="@ViewBag.ThemeName" asp-controller="TRLs" asp-action="Index">TRL</a> </h5>
                </div>


            </div>



            <div style="overflow-x:auto;">
                <table class="table table-hover table-bordered" style="text-align: center; ">

                    <thead>
                        <tr>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;"></th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;"></th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">№ этапа</th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Этап</th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Срок выполнения - начало</th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Срок выполнения - конец</th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Сумма этапа</th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Акт о завершении</th>
                            <th scope="col" style="padding-bottom:0; padding-top:0rem; padding-left: 1.5rem;vertical-align: middle;">Статус</th>
                        </tr>
                    </thead>


                    @{int i = 1;}
                    @foreach (var stage in @ViewBag.Stages)
                    {

                        <tbody>
                            <tr>
                                <td style="vertical-align:middle"><a asp-controller="Stages" asp-action="ChangingStage" asp-route-id="@stage.Id"> <i class="fa fa-pencil" aria-hidden="true"></i></a></td>
                                <td style="vertical-align:middle"><a onclick="deleteStage('@stage.Id')" href="#"> <i class="fa fa-trash" aria-hidden="true"></i></a></td>
                                <td>@i</td>
                                <td>@stage.StageName</td>

                                @if (@stage.WorkStart != null)
                                {
                                    if (@stage.WorkEnd != null)
                                    {
                                        <td>@stage.WorkStart.ToString("dd/MM/yyyy")</td>
                                        <td>@stage.WorkEnd.ToString("dd/MM/yyyy")</td>
                                    }
                                    else
                                    {
                                        <td>@stage.WorkStart.ToString("dd/MM/yyyy")</td>
                                        <td>@stage.WorkEnd</td>
                                    }
                                }
                                else if (@stage.WorkEnd != null)
                                {
                                    <td>@stage.WorkStart</td>
                                    <td>@stage.WorkEnd.ToString("dd/MM/yyyy")</td>
                                }
                                else
                                {
                                    <td>@stage.WorkStart</td>
                                    <td>@stage.WorkEnd</td>
                                }

                                <td>@stage.Amount</td>
                                <td>@stage.CompletionAct</td>
                                <td>@stage.Status</td>


                            </tr>
                        </tbody>

                        i++;

                    }

                </table>
            </div>



            <h3>Финансирование по годам</h3>

            @*<table class="table table-hover " style="text-align: center;">

                <thead>
                    <tr>
                        <th scope="col"></th>
                        <th scope="col">Год</th>
                        <th scope="col">Сумма</th>
                        <th scope="col"></th>
                        <th scope="col"></th>

                    </tr>
                </thead>

                <tbody>
                    @foreach (var annualFinancing in @ViewBag.AnnualFinancings)
                    {
                        <tr>
                            <td></td>
                            <td>@annualFinancing.Year</td>
                            <td>@annualFinancing.Amount</td>

                            <td>@Html.ActionLink("изменить", "AnnualFinancing", new { id = annualFinancing.Id })</td>
                            <td><a onclick="deleteUser('@annualFinancing.Id')" href="#"> удалить </a></td>
                        </tr>
                    }
                </tbody>
            </table>

            <form method="post" asp-controller="AnnualFinancings" asp-action="AddAnnualFinancings" class="my-5 col-5" style="border-style: dashed; border-width:thin; border-color: #343a40; padding: 8px; ">
                <table>
                    <h4>Финансирование по годам</h4>

                    <tr>
                        <td style="padding: 4px;">Год:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="Year" value="@ViewBag.AnnualFinancings.Year" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 4px;">Сумма:</td>
                        <td style="padding: 4px;">
                            <input type="text" name="Amount" value="@ViewBag.AnnualFinancings.Amount" />
                        </td>
                    </tr>

                    <tr>
                        <td style="padding: 2px;">
                            <input type="submit" class="btn btn-primary" value="Добавить" />
                        </td>
                        <td></td>
                    </tr>

                </table>
            </form>*@


            <div class="mb-3 row">
                <div class="col-sm-4"></div>

                <div class="col-sm-4">
                    <a class="btn btn-outline-dark" href="/Themes" style="text-align:center">Назад</a>
                </div>

                <div class="col-sm-4"></div>

            </div>


        </div>

    </div>
</div>


<script type="text/javascript">
    function deleteUser(stageId) {
        $.ajax({
            url: '/delete_stage/' + stageId,
            type: 'DELETE',
            contentType: "application/json; charset=utf-8",
            success: function () {
                location.reload()
            },
            error: function () {
                alert("Ошибка выполнения!")
            }
        })
    }
</script>
